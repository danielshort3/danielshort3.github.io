<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <base href="/">
  <title>Smart Sentence Finder</title>
  <meta name="description" content="Find the most relevant sentences in Alice in Wonderland for your query using precomputed embeddings and the Snowflake model." />
  <meta name="theme-color" content="#0D1117" />
  <link rel="icon" href="data:," />
  <link rel="stylesheet" href="dist/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@600&display=swap" rel="stylesheet">
  <style>
    :root {
      --radius: 12px;
      --shadow-1: 0 2px 10px rgba(0,0,0,.06), 0 1px 4px rgba(0,0,0,.06);
      --shadow-2: 0 8px 30px rgba(0,0,0,.12), 0 2px 8px rgba(0,0,0,.08);
      --muted: var(--text-muted, #bfc8d3);
      --text: var(--text-light, #f1f4f8);
      --surface-2: var(--surface-light, #1f2635);
      --page-pad: clamp(12px, 3vw, 24px);
      --accent: var(--primary, #2396ad);
      --border: var(--surface-accent, #21262d);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    html[data-embedded="true"],
    html[data-embedded="true"] body { height: auto !important; min-height: 0 !important; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 500px at 50% -10%, color-mix(in srgb, var(--accent) 20%, transparent), transparent 60%) var(--bg, #0d1117);
      display: grid;
      place-items: start center;
      padding: var(--page-pad);
      overflow-x: hidden;
    }
    .card {
      width: min(100%, 820px);
      background: var(--surface, #161b22);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-2);
      overflow: hidden;
    }
    .card-header {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
      padding: 18px;
      background: linear-gradient(0deg, var(--surface, #161b22), var(--surface-2));
      border-bottom: 1px solid var(--border);
    }
    .headline {
      min-width: 0;
    }
    h1 {
      margin: 0;
      font-family: Poppins, Inter, system-ui, sans-serif;
      font-size: 1.2rem;
    }
    .eyebrow {
      margin: 0 0 4px;
      font-size: .8rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--muted);
    }
    .muted {
      color: var(--muted);
      font-size: .9rem;
      margin: 0;
    }
    .title-stack {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      align-items: center;
      gap: 16px;
    }
    .title-copy {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .status {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      flex-shrink: 0;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid var(--border);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: .85rem;
      color: var(--muted);
      background: var(--surface-2);
    }
    .pill.ok {
      color: var(--success, #38b37e);
      border-color: color-mix(in srgb, var(--success, #38b37e) 65%, var(--border) 35%);
    }
    .pill.err {
      color: var(--danger, #e05757);
      border-color: color-mix(in srgb, var(--danger, #e05757) 65%, var(--border) 35%);
    }
    .section {
      padding: 18px;
    }
    .section + .section {
      border-top: 1px solid var(--border);
    }
    form {
      display: grid;
      gap: 16px;
    }
    label {
      font-size: .85rem;
      color: var(--muted);
      display: block;
      margin-bottom: 6px;
    }
    input[type="text"],
    input[type="number"],
    input[type="url"] {
      width: 100%;
      background: var(--surface-2);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 1rem;
      outline: none;
    }
    input::placeholder {
      color: color-mix(in srgb, var(--muted) 80%, #fff 20%);
    }
    .range-row {
      display: grid;
      gap: 8px;
    }
    .range-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: .85rem;
      color: var(--muted);
    }
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.08));
      border: 1px solid var(--border);
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(180deg, var(--accent), color-mix(in srgb, var(--accent) 75%, #fff 25%));
      border: 1px solid rgba(255,255,255,.25);
      box-shadow: var(--shadow-1);
      cursor: pointer;
    }
    input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(180deg, var(--accent), color-mix(in srgb, var(--accent) 75%, #fff 25%));
      border: 1px solid rgba(255,255,255,.25);
      box-shadow: var(--shadow-1);
      cursor: pointer;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-width: 160px;
      padding: 12px 18px;
      border-radius: 10px;
      border: 1px solid color-mix(in srgb, var(--accent) 85%, #fff 15%);
      color: var(--bg, #0d1117);
      font-weight: 600;
      letter-spacing: .01em;
      background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 95%, #fff 5%), color-mix(in srgb, var(--accent) 75%, #000 25%));
      cursor: pointer;
    }
    .btn:disabled {
      opacity: .6;
      cursor: not-allowed;
    }
    .results {
      display: grid;
      gap: 10px;
    }
    .item {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      display: grid;
      gap: 10px;
    }
    .small {
      font-size: .85rem;
      color: var(--muted);
    }
    .meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: .85rem;
      color: var(--muted);
    }
    .percent {
      font-weight: 600;
      color: color-mix(in srgb, var(--accent) 70%, #fff 30%);
    }
    .meter {
      position: relative;
      height: 12px;
      border-radius: 999px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.08));
      border: 1px solid var(--border);
    }
    .meter .fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), color-mix(in srgb, var(--accent) 75%, #fff 25%));
    }
    .sentence {
      line-height: 1.6;
      font-size: 1rem;
    }
    pre {
      margin: 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: .85rem;
      white-space: pre-wrap;
      color: var(--muted);
    }
    @media (max-width: 640px) {
      .title-stack {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      .status {
        justify-content: flex-start;
      }
      .actions {
        width: 100%;
      }
      .btn {
        width: 100%;
        min-width: 0;
      }
    }
  </style>
  <script>
    if (window.self !== window.top) {
      document.documentElement.setAttribute('data-embedded', 'true');
    }
  </script>
  <script>
    const DEFAULT_URL = "https://7aa3jt3tzkinheprc5ds52bihq0itutx.lambda-url.us-east-2.on.aws/";
    const DEFAULT_QUERY = "She wonders about things.";

    const notifyResize = (() => {
      const CHANNEL = 'sentence-demo-resize';
      const calcHeight = () => {
        const doc = document.documentElement;
        const body = document.body || doc;
        return Math.ceil(Math.max(
          body.scrollHeight,
          body.offsetHeight,
          doc.clientHeight,
          doc.scrollHeight,
          doc.offsetHeight
        ));
      };
      const postHeight = () => {
        try { parent.postMessage({ type: CHANNEL, height: calcHeight() }, '*'); } catch (e) {}
      };
      window.addEventListener('load', postHeight);
      try { document.fonts?.ready?.then(postHeight); } catch (e) {}
      if ('ResizeObserver' in window) {
        const ro = new ResizeObserver(() => postHeight());
        ro.observe(document.documentElement);
      } else {
        let prev = 0;
        setInterval(() => {
          const h = calcHeight();
          if (Math.abs(h - prev) > 4) {
            prev = h;
            postHeight();
          }
        }, 750);
      }
      return postHeight;
    })();

    async function health() {
      const url = getEndpoint();
      const $status = document.getElementById('health');
      try {
        const r = await fetch(url + 'health');
        if (!r.ok) throw new Error(await r.text());
        await r.json();
        $status.className = 'pill ok';
        $status.textContent = 'Server Ready';
        notifyResize();
      } catch (e) {
        $status.className = 'pill err';
        $status.textContent = 'Server Not Ready';
        console.error(e);
        notifyResize();
      }
    }

    function getEndpoint() {
      return DEFAULT_URL;
    }

    async function onSubmit(ev) {
      ev.preventDefault();
      const form = ev.currentTarget;
      const queryInput = form.query;
      const rawQuery = (queryInput?.value || '').trim();
      const fallback = (() => {
        if (!queryInput) return DEFAULT_QUERY;
        if (queryInput.dataset.exampleQuery) {
          return queryInput.dataset.exampleQuery.trim();
        }
        const placeholder = (queryInput.getAttribute('placeholder') || '').replace(/^Example:\s*/i, '');
        return placeholder.trim() || DEFAULT_QUERY;
      })();
      const query = rawQuery || fallback;
      const top = Math.max(1, Math.min(20, parseInt(form.top.value || '5', 10)));
      form.submitBtn.disabled = true;
      form.submitBtn.textContent = 'Searching…';
      const url = getEndpoint() + 'rank';
      const headers = { 'content-type': 'application/json' };
      try {
        const res = await fetch(url, { method: 'POST', headers, body: JSON.stringify({ query, top }) });
        const text = await res.text();
        if (!res.ok) throw new Error(text);
        const data = JSON.parse(text);
        renderResults(data);
      } catch (e) {
        renderError(e);
      } finally {
        form.submitBtn.disabled = false;
        form.submitBtn.textContent = 'Find Sentences';
      }
    }

    function renderResults(data) {
      const out = document.getElementById('results');
      out.innerHTML = '';
      const list = document.createElement('div');
      list.className = 'results';
      (data.top || []).forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'item';
        const raw = (typeof item.score === 'number' ? item.score : 0);
        const val = Math.max(0, Math.min(1, raw));
        const percent = (val * 100);
        const meta = document.createElement('div');
        meta.className = 'meta';
        const rank = document.createElement('div');
        rank.textContent = `#${idx + 1}`;
        const perc = document.createElement('div');
        perc.className = 'percent';
        perc.textContent = `${percent.toFixed(1)}%`;
        meta.append(rank, perc);
        const bar = document.createElement('div');
        bar.className = 'meter';
        bar.setAttribute('role', 'progressbar');
        bar.setAttribute('aria-valuemin', '0');
        bar.setAttribute('aria-valuemax', '100');
        bar.setAttribute('aria-valuenow', percent.toFixed(1));
        const fill = document.createElement('div');
        fill.className = 'fill';
        fill.style.width = `${percent.toFixed(1)}%`;
        bar.appendChild(fill);
        const sent = document.createElement('div');
        sent.className = 'sentence';
        sent.textContent = item.sentence || '';
        div.append(meta, bar, sent);
        list.appendChild(div);
      });
      if (!list.children.length) {
        const m = document.createElement('div');
        m.className = 'small';
        m.textContent = 'No results.';
        out.appendChild(m);
      } else {
        out.appendChild(list);
      }
      notifyResize();
    }

    function renderError(err) {
      const out = document.getElementById('results');
      out.innerHTML = '';
      const box = document.createElement('div');
      box.className = 'item';
      const h = document.createElement('div');
      h.className = 'small';
      h.style.color = 'var(--danger, #e05757)';
      h.textContent = 'Error';
      const pre = document.createElement('pre');
      pre.textContent = String(err);
      box.appendChild(h);
      box.appendChild(pre);
      out.appendChild(box);
      notifyResize();
    }

    function onLoad() {
      const form = document.getElementById('form');
      form.addEventListener('submit', onSubmit);
      const topRange = document.getElementById('top');
      const topValue = document.getElementById('top-value');
      if (topRange && topValue) {
        const sync = () => { topValue.textContent = topRange.value; };
        topRange.addEventListener('input', sync);
        sync();
      }
      notifyResize();
      try { document.fonts?.ready?.then(notifyResize); } catch (e) {}
      window.addEventListener('load', notifyResize);
      window.addEventListener('resize', () => setTimeout(notifyResize, 50));
      health();
    }
    window.addEventListener('DOMContentLoaded', onLoad);
  </script>
  <meta property="og:title" content="Smart Sentence Finder" />
  <meta property="og:description" content="Query Alice in Wonderland and get the most similar sentences using embeddings." />
  <meta property="og:type" content="website" />
</head>
<body>
  <div class="card" id="demo-card">
    <header class="card-header">
      <div class="headline">
        <div class="title-stack">
          <div class="title-copy">
            <p class="eyebrow">Embeddings demo</p>
            <h1>Smart Sentence Finder</h1>
          </div>
          <div class="status">
            <span id="health" class="pill">Checking…</span>
          </div>
        </div>
        <p class="muted">Search all of Alice in Wonderland and pull back the most similar sentences.</p>
      </div>
    </header>
    <div class="section">
      <form id="form">
        <div>
          <label for="query">Your query</label>
          <input id="query" name="query" type="text" placeholder="Example: She wonders about things." data-example-query="She wonders about things." />
        </div>
        <div class="range-row">
          <div class="range-head">
            <label for="top">Top results</label>
            <span><span id="top-value">5</span> of 20</span>
          </div>
          <input id="top" name="top" type="range" min="1" max="20" step="1" value="5" aria-label="Top results" />
        </div>
        <div class="actions">
          <button type="submit" name="submitBtn" class="btn">Find Sentences</button>
        </div>
      </form>
    </div>
    <div class="section">
      <div id="results" class="results">
        <div class="small">Results will appear here.</div>
      </div>
    </div>
  </div>
</body>
</html>
