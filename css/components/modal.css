/* Modal windows */

/* ───────────────────────────────────────────────────────────
   9.  MODALS
   ─────────────────────────────────────────────────────────── */
@layer components {
  .modal{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background:color-mix(in srgb,var(--bg) 88%,transparent);backdrop-filter:blur(4px);
    opacity:0;pointer-events:none;transition:opacity .45s ease;z-index:2000
  }
  .modal.active{opacity:1;pointer-events:auto}
  body.modal-open{overflow:hidden;padding-right:var(--scrollbar,0px)}
  .modal-content{
    position:relative;max-height:82vh;margin:5% 12px;
    width: min(var(--modal-max), calc(100vw - 24px));
    max-width: var(--modal-max);
    display:flex;flex-direction:column;overflow:hidden;
    background:var(--surface); /* unified darker surface */
    color:var(--text-light);
    padding:24px 32px;
    font-size:1rem;line-height:1.7;
    border-radius:16px;
    box-shadow:
      0 12px 32px rgba(0, 0, 0, 0.6),
      0 0 0 1px color-mix(in srgb, var(--primary) 20%, transparent);
    transform:translateY(-24px) scale(.96);opacity:0;
    transition:transform .45s cubic-bezier(.22,.61,.36,1),opacity .45s cubic-bezier(.22,.61,.36,1)
  }
  /* wider layout for embedded content */
  .modal-content.modal-wide{
    width: min(var(--modal-max-wide, var(--container-max)), calc(100vw - 24px));
    max-width: var(--modal-max-wide, var(--container-max));
  }
  .modal.active .modal-content{transform:none;opacity:1}
  .modal-content::before{content:"";position:absolute;inset:0 0 auto 0;height:4px;border-radius:16px 16px 0 0;background:var(--primary)}
  .modal-close{
    position:absolute;top:14px;right:18px;background:none;border:none;cursor:pointer;
    font-size:30px;line-height:1;color:var(--text-muted);transition:color .25s
  }
  .modal-close:hover{color:var(--primary);text-shadow:0 0 4px color-mix(in srgb,var(--primary) 40%,transparent)}
  .modal-title-strip{ text-align:center; padding:32px 28px 24px; border-bottom: 1px solid color-mix(in srgb, var(--text-light) 10%, transparent); }
  .modal-title{margin:0;font-family:'Poppins';font-weight:600;font-size:1.9rem;letter-spacing:.3px;color:var(--primary)}

  .modal-header-details{
    flex:0 0 100%;
    display:flex;flex-wrap:wrap;justify-content:space-around;gap:12px;
    padding:22px 0; /* remove horizontal padding */
    background:var(--surface-accent);
    border-top:1px solid color-mix(in srgb,var(--text-light) 12%,transparent);
    border-bottom:1px solid color-mix(in srgb,var(--text-light) 12%,transparent);
    position:relative;
  }
  .modal-half{flex:1 1 260px;text-align:center;position:relative;padding:12px 0}
  .header-label{
    margin:0 0 10px;font-weight:600;font-size:.95rem;color:var(--primary);
    text-transform:uppercase;letter-spacing:.6px
  }
  .tool-badges,.icon-row{display:flex;justify-content:center;flex-wrap:wrap;gap:10px}
  .badge{
    background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary);
    padding:4px 10px;border-radius:6px;font-size:.85rem;font-weight:500
  }
  .icon-row .icon{width:38px;height:38px}

  .modal-body{
    flex:1 1 auto;
    display:flex;flex-wrap:wrap;gap:32px;padding:0 32px 32px;
    overflow-y:auto;
  }
  .modal-text{flex:1 1 340px;font-size:1rem;line-height:1.75;color:var(--text-light)}
  .modal-text p{margin:0 0 .85em}
  .modal-text ul{margin:.5em 0 1em}
  .modal-text h4{color:var(--primary);margin-top:1em;margin-bottom:.5em;font-size:1.2rem}
  .modal-text ul{padding-left:20px}
  .modal-subtitle{margin-top:0;color:var(--text-muted)}
  .modal-image{flex:1 1 300px;align-self:flex-start}
  .modal-image img{max-width:100%;border-radius:12px;display:block;box-shadow:0 6px 24px rgba(0,0,0,.4)}
  .modal-image video{max-width:100%;border-radius:12px;display:block;box-shadow:0 6px 24px rgba(0,0,0,.4)}
  .modal-content :focus-visible{outline:2px solid var(--focus);outline-offset:2px}

  /* Copy link button near the close button */
  .modal-copy{
    position:absolute;top:16px;right:56px;
    background:transparent;color:var(--text-muted);
    border:1px solid var(--surface-accent);border-radius:8px;
    padding:6px 10px;cursor:pointer;font-size:.85rem;
    transition:color .2s,border-color .2s,transform .2s;
  }
  .modal-copy:hover,.modal-copy:focus-visible{
    color:var(--primary);border-color:var(--primary);transform:translateY(-1px)
  }

  /* Non-intrusive toast for copy feedback */
  .modal-toast{
    position:absolute;left:50%;bottom:12px;transform:translateX(-50%);
    background: color-mix(in srgb, var(--surface) 85%, #000 15%);
    color: var(--text-light);
    border: 1px solid var(--surface-accent);
    padding: 6px 10px;
    border-radius: 8px;
    font-size: .85rem;
    box-shadow: var(--shadow-sm);
    opacity: 0; pointer-events: none;
    transition: opacity .25s ease;
  }
  .modal-toast.show{ opacity: 0.92; }

  /* Divider between Tools and Downloads */
  .modal-divider {
    position: absolute; left: 50%; top: 20%; width: 1px; height: 60%;
    background: color-mix(in srgb, var(--text-light) 12%, transparent);
    transform: translateX(-50%);
  }

  /* keep modal within the viewport on all screens */
  #contact-modal .modal-content { width: min(760px, calc(100vw - 24px)); margin-inline:auto; }
  #contact-modal .modal-body { overflow-x:hidden; }
  #contact-modal iframe { width:100%; border:none; display:block; height:100%; }

  /* embedded demo modals */
  #shapeClassifier-modal iframe,
  #chatbotLora-modal iframe {
    height: 80vh; /* final effective height */
    margin-top: 0; width: 100%; border: 1px solid var(--surface-accent);
  }
  #shapeClassifier-modal .modal-embed,
  #chatbotLora-modal .modal-embed { flex:0 0 50%; max-width:50%; align-self:flex-start; overflow:visible; }
  @media (max-width: 768px) {
    #shapeClassifier-modal .modal-embed,
    #chatbotLora-modal .modal-embed { flex-basis:100%; max-width:100%; }
  }

  /* ensure Tableau embeds always appear after the text */
  .modal-body.stacked .modal-embed { order: 99; }
  .modal-embed { overflow-x:auto; width:100%; }
  .modal-embed iframe { width:100%; height:70vh; border:none; display:block; margin-top:1rem; }
  .tableau-scale-inner { transform-origin: top left; }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .modal-header-details { flex-direction:column; align-items:center; }
    .modal-half { flex:1 1 auto; width:100%; }
    .modal-divider { position: static; width: 80%; height: 1px; margin: 12px 0; transform: none; }
    .modal-body { padding:4px !important; }
  }
}
