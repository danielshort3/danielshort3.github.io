/* Public-facing docs organised by category
   Update/extend this array – only the data lives here!
   ─────────────────────────────────────────────────────────── */
window.contributions = [
  {
    heading:'Various Public Contributions',
    desc   :'Reports and public documents where I led or contributed to data modeling and analysis that informed city planning and marketing.',
    items  : [
      { title:'Colorado Business Economic Outlook · 2025',
        role :'Contributions: Pages 122:129 - Data aggregation and analysis',
        link :'https://www.colorado.edu/business/brd/colorado-business-economic-outlook-forum',
        pdf  :'documents/Leeds_2025_Colorado_Business_Economic_Outlook.pdf' 
      },
      { title:'Grand Junction City Budget · 2025',
        role :'Contributions: Pages 199:214 - Data aggregation and analysis',
        link :'https://www.gjcity.org/DocumentCenter/View/14655',
        pdf  :'documents/GJ_2025_Budget.pdf' 
      },
      { title:'Visit Grand Junction Annual Accomplishments · 2024',
        role :'Contributions: Data aggregation and analysis',
        link :'https://visitgj.com/4hcADGt',
        pdf  :'documents/VGJ_2024_Accomplishments.pdf' 
      }
    ]
  },

  {
    heading: 'Council Briefings',
    desc   : 'Briefings for Grand Junction City Council. I contributed actionable data insights and visualizations used by decision makers.',
    items  : [
      { title:'May 9, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-may-9-2025' 
      },
      { title:'April 18, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-april-18-2025' 
      },
      { title:'April 4, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-april-4-2025' 
      },
      { title:'March 21, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-march-21-2025' 
      },
      { title:'March 7, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-march-7' 
      },
      { title:'February 21, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-february-21' 
      },
      { title:'February 7, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-february-7' 
      },
      { title:'January 17, 2025 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-january-17' 
      },
      { title:'December 20, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-december-20' 
      },
      { title:'November 25, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-november-25' 
      },
      { title:'November 12, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-november-12' 
      },
      { title:'October 21, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-october-21' 
      },
      { title:'October 14, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-october-14' 
      },
      { title:'September 23, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-september-23' 
      },
      { title:'September 16, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-september-13' 
      },
      { title:'August 26, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-august-26' 
      },
      { title:'August 12, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://www.gjcity.org/DocumentCenter/View/13425/City-Council-Briefing-August-12-2024' 
      },
      { title:'July 22, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-july-22' 
      },
      { title:'July 8, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-july-8' 
      },
      { title:'June 10, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-june-10' 
      },
      { title:'May 17, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-may-17' 
      },
      { title:'May 3, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/city-council-briefing-may-3' 
      },
      { title:'April 19, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://ccbrief.my.canva.site/april19' 
      },
      { title:'April 5, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://new.express.adobe.com/webpage/6y0JHWFDI5biO' 
      },
      { title:'March 22, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://new.express.adobe.com/webpage/y51YVfnRLHb8d' 
      },
      { title:'March 8, 2024 Council Briefing',
        role :'Contributions: Visit Grand Junction section',
        link :'https://new.express.adobe.com/webpage/gvosfJu0N5ywV' 
      }
    ]
  },

  {
    heading:'Visit Grand Junction eNewsletters',
    desc   :'Tourism industry eNewsletters featuring my analytics, pacing reports, and lodging performance insights sent to stakeholders.',
    items  : [
      { title:'Stakeholder eNewsletter · April 2025',
        role :'Contributions: Industry Data Report, Elizabeth\'s GJ Communiqué, Lodging Cannibalization Part 2',
        link :'https://us4.campaign-archive.com/?e=18b7bff0b8&u=d69163b71ce34ec42d130a6a4&id=16d85d0a8e' 
      },
      { title:'Stakeholder eNewsletter · March 2025',
        role :'Contributions: Industry Data Report, Elizabeth\'s GJ Communiqué, Lodging Cannibalization',
        link :'https://us4.campaign-archive.com/?e=18b7bff0b8&u=d69163b71ce34ec42d130a6a4&id=76eef051b3' 
      },
      { title:'Stakeholder eNewsletter · February 2025',
        role :'Contributions: Industry Data Report',
        link :'https://us4.campaign-archive.com/?e=ab674ce95e&u=d69163b71ce34ec42d130a6a4&id=1590378e4c' 
      },
      { title:'Stakeholder eNewsletter · January 2025',
        role :'Contributions: Lodging Tax Revenue Report',
        link :'https://us4.campaign-archive.com/?e=ab674ce95e&u=d69163b71ce34ec42d130a6a4&id=1590378e4c' 
      },
      { title:'Stakeholder eNewsletter · December 2024',
        role :'Contributions: Lodging Tax Revenue Report, Website Performance Data',
        link :'https://us4.campaign-archive.com/?e=f5ce3bd589&u=d69163b71ce34ec42d130a6a4&id=87fdbebaf6' 
      },
      { title:'Stakeholder eNewsletter · November 2024',
        role :'Contributions: Lodging Tax Revenue Report',
        link :'https://us4.campaign-archive.com/?e=f5ce3bd589&u=d69163b71ce34ec42d130a6a4&id=bcba2760e8' 
      },
      { title:'Stakeholder eNewsletter · October 2024',
        role :'Contributions: Lodging Tax Revenue Report, Join the Adventure!',
        link :'https://us4.campaign-archive.com/?e=f5ce3bd589&u=d69163b71ce34ec42d130a6a4&id=2d7388ee76' 
      },
      { title:'Stakeholder eNewsletter · September 2024',
        role :'Contributions: Lodging Tax Revenue Report',
        link :'https://us4.campaign-archive.com/?e=f5ce3bd589&u=d69163b71ce34ec42d130a6a4&id=f9eec9e21f' 
      },
      { title:'Stakeholder eNewsletter · August 2024',
        role :'Contributions: Lodging Tax Revenue Report, Elizabeth\'s GJ Communiqué, Grand Junction Hotel Performance Update',
        link :'https://us4.campaign-archive.com/?e=f5ce3bd589&u=d69163b71ce34ec42d130a6a4&id=f9eec9e21f' 
      },
      { title:'Stakeholder eNewsletter · July 2024',
        role :'Contributions: Lodging Tax Revenue Report, Elizabeth\'s GJ Communiqué',
        link :'https://us4.campaign-archive.com/?e=18b7bff0b8&u=d69163b71ce34ec42d130a6a4&id=19ae68609c' 
      },
      { title:'Stakeholder eNewsletter · June 2024',
        role :'Contributions: Lodging Tax Revenue Report, Elizabeth\'s GJ Communiqué',
        link :'https://us4.campaign-archive.com/?u=d69163b71ce34ec42d130a6a4&id=71c73cdd2b' 
      },
      { title:'Stakeholder eNewsletter · May 2024',
        role :'Contributions: Lodging Tax Revenue Report',
        link :'https://us4.campaign-archive.com/?u=d69163b71ce34ec42d130a6a4&id=71c73cdd2b' 
      },
      { title:'Stakeholder eNewsletter · April 2024',
        role :'Contributions: Lodging Tax Revenue Report',
        link :'https://us4.campaign-archive.com/?e=f5ce3bd589&u=d69163b71ce34ec42d130a6a4&id=cd0cc7edcd' 
      }
    ]
  }
];

/* ────────────────────────────────────────────────────────────
   DOM-builder
   ─────────────────────────────────────────────────────────── */
function buildContributions(){
  const root = document.getElementById('contrib-root');
  if(!root || !window.contributions) return;

  window.contributions.forEach(sec=>{
    // --- section shell -------------------------------------------------
    const section = document.createElement('section');
    section.className = 'surface-band reveal contrib-section';
    section.dataset.heading = sec.heading;

    const wrap   = document.createElement('div');
    wrap.className = 'wrapper';
    section.appendChild(wrap);

    // Heading + blurb
    wrap.insertAdjacentHTML('beforeend',
      `<h2 class="section-title">${sec.heading}</h2>
       <p class="section-desc">${sec.desc}</p>`);

    // Grid
    const grid = document.createElement('div');
    grid.className = 'grid docs-grid docs-carousel';
    wrap.appendChild(grid);

    // --- cards ---------------------------------------------------------
    sec.items.forEach(item => {
      const card = document.createElement('article');
      card.className = 'doc-card';

      card.innerHTML = `
        <div class="doc-layout">
          <h3 class="doc-title">${item.title}</h3>
          <div class="doc-footer">
            ${item.role ? `<p class="doc-role">${item.role}</p>` : ''}
            <div class="doc-links">
              ${item.pdf ? `<a href="${item.pdf}" target="_blank" class="doc-link" aria-label="Open PDF" download><i class="fas fa-file-pdf"></i></a>` : ''}
              ${item.link ? `<a href="${item.link}" target="_blank" class="doc-link" aria-label="Open external link"><i class="fas fa-external-link-alt"></i></a>` : ''}
            </div>
          </div>
        </div>
      `;

      grid.appendChild(card);
    });


    root.appendChild(section);

    /* ── NEW: 64 px surface-coloured band between sections ── */
    if (sec !== window.contributions.at(-1)){   // skip the very last block
      const gap = document.createElement('section');
      gap.className = 'contrib-gap';            // styled in styles.css
      root.appendChild(gap);
    }

  });
}

/* Collapse contributions on mobile with See More/See Less toggle.
   Desktop always shows all items and never displays the button.    */
function initContribSeeMore(){
  const mq = window.matchMedia('(max-width: 768px)');

  const teardown = btn => {
    const wrap = btn.parentElement;
    if (btn._observer)    { btn._observer.disconnect();    btn._observer = null; }
    if (btn._nextObs)     { btn._nextObs.disconnect();     btn._nextObs = null; }
    if (btn._onScroll)    { window.removeEventListener('scroll', btn._onScroll); btn._onScroll = null; }
    btn._sectionVisible = true;
    btn._nextVisible    = false;
    btn._topOverlap     = false;
    if (wrap) wrap.classList.remove('sticky', 'fade-out');
  };

  const setup = btn => {
    const section = btn.closest('.contrib-section');
    const grid = section && section.querySelector('.docs-grid');
    const wrap = btn.parentElement;
    if (!section || !grid || !wrap) return;
    if (grid.scrollHeight <= window.innerHeight || btn.dataset.expanded !== 'true') { teardown(btn); return; }

    wrap.classList.add('sticky');

    const updateFade = () => {
      let hide = !btn._sectionVisible || btn._nextVisible || btn._topOverlap;
      if (!hide && btn._firstCard) {
        const cRect = btn._firstCard.getBoundingClientRect();
        const bRect = wrap.getBoundingClientRect();
        hide = cRect.bottom > bRect.top && cRect.top < bRect.bottom;
        btn._topOverlap = hide;
      }
      wrap.classList.toggle('fade-out', hide);
    };

    if (!btn._observer) {
      btn._sectionVisible = true;
      const io = new IntersectionObserver(entries => {
        btn._sectionVisible = entries[0].isIntersecting;
        updateFade();
      });
      io.observe(section);
      btn._observer = io;
    }

    if (!btn._nextObs) {
      const nextWrap = section.nextElementSibling?.querySelector('.see-more-wrap');
      if (nextWrap) {
        btn._nextVisible = false;
        const io2 = new IntersectionObserver(entries => {
          btn._nextVisible = entries[0].isIntersecting;
          updateFade();
        });
        io2.observe(nextWrap);
        btn._nextObs = io2;
      }
    }

    if (!btn._onScroll) {
      btn._firstCard = grid.firstElementChild;
      btn._onScroll = () => updateFade();
      window.addEventListener('scroll', btn._onScroll, { passive: true });
      updateFade();
    } else {
      btn._firstCard = grid.firstElementChild;
      updateFade();
    }
  };

  const updateFloat = btn => {
    if (btn.dataset.expanded === 'true') setup(btn); else teardown(btn);
  };

  const apply = enable => {
    document.querySelectorAll('.contrib-section').forEach(section => {
      const grid  = section.querySelector('.docs-grid');
      if(!grid) return;
      const cards = [...grid.children];
      if(cards.length <= 1) return;

      // find existing button/wrapper if present
      let btn = section.querySelector('.see-more-btn');
      let wrap = section.querySelector('.see-more-wrap');

      if(enable){
        if(!btn){
          wrap = document.createElement('div');
          wrap.className = 'see-more-wrap';
          wrap.style.textAlign = 'center';
          wrap.style.marginTop = '12px';
          btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'btn-primary see-more-btn';
          btn.textContent = 'See More';
          btn.dataset.expanded = 'false';
          wrap.appendChild(btn);
          section.querySelector('.wrapper').appendChild(wrap);

          btn.addEventListener('click', () => {
            const expanded = btn.dataset.expanded === 'true';
            btn.dataset.expanded = expanded ? 'false' : 'true';
            const isExpanded = btn.dataset.expanded === 'true';
            btn.textContent = isExpanded ? 'See Less' : 'See More';
            cards.slice(1).forEach(c => c.classList.toggle('hide', !isExpanded));
            if (window.gaEvent) {
              window.gaEvent('contrib_see_more_toggle', {
                expanded: isExpanded,
                section: section.dataset.heading || ''
              });
            }
            updateFloat(btn);
          });
        }
        const isExpanded = btn.dataset.expanded === 'true';
        cards.slice(1).forEach(c => c.classList.toggle('hide', !isExpanded));
        updateFloat(btn);
      } else {
        // remove button and show all cards
        if(wrap) { teardown(btn); wrap.remove(); }
        cards.slice(1).forEach(c => c.classList.remove('hide'));
      }
    });
  };

  apply(mq.matches);
  mq.addEventListener('change', e => apply(e.matches));
}

function initContributions(){
  buildContributions();
  initContribSeeMore();
}

document.addEventListener('DOMContentLoaded', initContributions);
